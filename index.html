<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Choudhary Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <style>
        body { background-color: #f3f4f6; }
        .nav-item { cursor: pointer; transition: all 0.2s; }
        .nav-item:hover { background-color: #374151; }
        .nav-item.active { background-color: #2563eb; border-right: 4px solid #60a5fa; }
        .section-panel { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-gray-800 h-screen flex overflow-hidden">

    <div id="login-overlay" class="fixed inset-0 z-50 bg-gray-900 flex items-center justify-center">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-96 text-center">
            <div class="mb-4 text-blue-600"><i class="fas fa-user-shield text-5xl"></i></div>
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Admin Access</h2>
            <form onsubmit="event.preventDefault(); login();" class="space-y-4">
                <input type="email" id="email" placeholder="admin@example.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition">
                <input type="password" id="password" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition">
                <button type="submit" class="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition shadow-lg">Login / Register</button>
            </form>
            <p id="login-msg" class="text-red-500 text-sm mt-4"></p>
        </div>
    </div>

    <aside class="w-64 bg-gray-900 text-white flex flex-col shadow-xl z-10">
        <div class="p-6 border-b border-gray-800 flex items-center gap-3">
            <i class="fas fa-crown text-yellow-500 text-xl"></i>
            <span class="font-bold text-lg tracking-wide">Choudhary Admin</span>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <div onclick="switchTab('about')" id="tab-about" class="nav-item px-6 py-3 flex items-center gap-3 active">
                <i class="fas fa-info-circle w-5 text-center"></i> About Us
            </div>
            <div onclick="switchTab('themes')" id="tab-themes" class="nav-item px-6 py-3 flex items-center gap-3">
                <i class="fas fa-paint-brush w-5 text-center"></i> Popular Themes
            </div>
            <div onclick="switchTab('facilities')" id="tab-facilities" class="nav-item px-6 py-3 flex items-center gap-3">
                <i class="fas fa-star w-5 text-center"></i> Special Services
            </div>
            <div onclick="switchTab('testimonials')" id="tab-testimonials" class="nav-item px-6 py-3 flex items-center gap-3">
                <i class="fas fa-comment-alt w-5 text-center"></i> Testimonials
            </div>
            <div onclick="switchTab('seo')" id="tab-seo" class="nav-item px-6 py-3 flex items-center gap-3 text-gray-400 hover:text-white">
                <i class="fas fa-search w-5 text-center"></i> SEO & Contact
            </div>
            <div onclick="switchTab('gallery')" id="tab-gallery" class="nav-item px-6 py-3 flex items-center gap-3 text-gray-400 hover:text-white">
                <i class="fas fa-images w-5 text-center"></i> Gallery
            </div>
        </nav>

        <div class="p-4 border-t border-gray-800 bg-gray-900">
            <div onclick="switchTab('settings')" id="tab-settings" class="nav-item px-4 py-2 rounded text-sm text-gray-400 hover:text-white mb-2 flex items-center gap-2">
                <i class="fas fa-cog"></i> Restore / Settings
            </div>
            <button onclick="saveChanges()" id="save-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-105">
                <i class="fas fa-save"></i> Publish Changes
            </button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto bg-gray-50 p-8 relative">
        
        <header class="flex justify-between items-center mb-8">
            <h1 id="page-title" class="text-3xl font-bold text-gray-800">Edit Website Content</h1>
            <button onclick="logout()" class="text-red-500 hover:text-red-700 font-medium text-sm flex items-center gap-1"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </header>

        <div id="panel-about" class="section-panel active">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <h2 class="text-xl font-bold mb-4 text-blue-700 border-b pb-2">About Us Content</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-semibold text-gray-600 mb-2">Description Text</label>
                        <textarea id="about-text" rows="8" class="w-full p-4 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50 text-gray-700 leading-relaxed"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-600 mb-2">About Image URL</label>
                        <input type="text" id="about-img" class="w-full p-3 border rounded-lg mb-4" placeholder="https://..." oninput="updatePreview('about-preview', this.value)">
                        <div class="h-48 bg-gray-100 rounded-lg overflow-hidden border flex items-center justify-center">
                            <img id="about-preview" src="" class="w-full h-full object-cover hidden">
                            <span class="text-gray-400 text-sm">Image Preview</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-themes" class="section-panel">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Popular Themes</h2>
                    <p class="text-gray-500 text-sm">These appear as buttons/tags on your site.</p>
                </div>
                <button onclick="addSimpleItem('serviceCategories')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow flex items-center gap-2"><i class="fas fa-plus"></i> Add Theme</button>
            </div>
            <div id="list-serviceCategories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </div>

        <div id="panel-facilities" class="section-panel">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Special Services</h2>
                    <p class="text-gray-500 text-sm">List your unique offerings (DJ, Valet, etc).</p>
                </div>
                <button onclick="addSimpleItem('facilities')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow flex items-center gap-2"><i class="fas fa-plus"></i> Add Service</button>
            </div>
            <div id="list-facilities" class="grid grid-cols-1 gap-3">
                </div>
        </div>

        <div id="panel-testimonials" class="section-panel">
             <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Client Testimonials</h2>
                <button onclick="addTestimonial()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 shadow flex items-center gap-2"><i class="fas fa-plus"></i> Add Review</button>
            </div>
            <div id="list-testimonials" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                </div>
        </div>

        <div id="panel-seo" class="section-panel">
             <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                <h2 class="text-xl font-bold mb-4">Contact Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="contact-phone" class="p-3 border rounded" placeholder="Phone">
                    <input type="text" id="contact-email" class="p-3 border rounded" placeholder="Email">
                    <input type="text" id="contact-address" class="p-3 border rounded md:col-span-2" placeholder="Address">
                </div>
             </div>
        </div>

        <div id="panel-gallery" class="section-panel">
             <div class="bg-white p-6 rounded-xl shadow-sm">
                <div class="flex justify-between mb-4">
                    <h2 class="text-xl font-bold">Image Gallery</h2>
                    <button onclick="addSimpleItem('galleryImages')" class="text-blue-600 font-bold">+ Add Image URL</button>
                </div>
                <div id="list-galleryImages" class="space-y-3"></div>
             </div>
        </div>

        <div id="panel-settings" class="section-panel">
            <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center max-w-2xl mx-auto mt-10">
                <div class="text-red-500 text-5xl mb-4"><i class="fas fa-exclamation-triangle"></i></div>
                <h2 class="text-2xl font-bold text-red-700 mb-2">Danger Zone</h2>
                <p class="text-red-600 mb-6">Restoring data will wipe all your custom changes and return the website to its original factory state.</p>
                <button onclick="restoreDefaultData()" class="bg-red-600 text-white font-bold py-3 px-8 rounded-lg shadow hover:bg-red-700 transition">
                    Restore Original Data
                </button>
            </div>
        </div>

    </main>

    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-6 py-4 rounded-lg shadow-xl transform translate-y-24 transition duration-300 flex items-center gap-3">
        <i class="fas fa-check-circle text-green-400"></i>
        <span>Changes Saved Successfully!</span>
    </div>

    <script>
        // ==========================================
        // 1. FIREBASE CONFIGURATION
        // ==========================================
       const firebaseConfig = {
  apiKey: "AIzaSyDP3sJrsTtJK0akGINs8FM_uD9kgCDXVVI",
  authDomain: "choudhary-display.firebaseapp.com",
  databaseURL: "https://choudhary-display-default-rtdb.firebaseio.com",
  projectId: "choudhary-display",
  storageBucket: "choudhary-display.firebasestorage.app",
  messagingSenderId: "201311724678",
  appId: "1:201311724678:web:d4ce389f4ffae76fb19d07",
  measurementId: "G-VBW112930K"
};

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Global Data Store
        let currentData = {};

        // ORIGINAL DEFAULT DATA (For Restore Feature)
        const defaultData = {
          "seo": { "title": "Choudhary Display - Party Specialist", "description": "30+ Years Experience", "keywords": "wedding, events" },
          "heroImageUrl": "images/hero1.jpeg",
          "businessLogoUrl": "images/logo.jpeg",
          "aboutText": "For over 30 years, Choudhary Display has been the leading event specialist in our region. We believe in creating magical, unforgettable moments. Our mission is to combine your vision with our expertise to deliver flawless events. From intimate gatherings to grand celebrations, our dedicated team handles every detail with passion and precision.",
          "aboutImageUrl": "images/aboutimg2.jpeg",
          "services": [
            { "title": "Dream Weddings", "imageUrl": "images/weddingimg1.jpeg" },
            { "title": "Other Events", "imageUrl": "images/otherimg1.jpeg" }
          ],
          "serviceCategories": ["Haldi Themes", "Reception Themes", "Floral Decor", "Modern & Minimal", "Royal & Traditional"],
          "keyServices": ["Full-Service Planning", "Venue Selection & Management", "Catering & Menu Design", "Vendor Coordination", "Guest Management"],
          "facilities": ["In-house DJ & Sound Systems", "Custom Stage & Lighting Design", "Interactive Photobooths", "Valet & Transport Services"],
          "galleryImages": ["images/img1.jpeg", "images/img2.jpeg", "images/img3.jpeg", "images/img4.jpeg", "images/img5.jpeg"],
          "testimonials": [
            { "name": "Priya & Rohan Sharma", "event": "Our Wedding", "quote": "They made our day absolutely magical! Every single detail was perfect." },
            { "name": "Mr. R. Gupta, CEO", "event": "Annual Corporate Gala", "quote": "Flawless execution for our annual gala." }
          ],
          "contactInfo": { "address": "Pancham Villa Sayaji Park Ajwa Road Vadodra Gujrat", "phone": "+91 9328544199", "email": "vikaschoudhary05052007@gmail.com" },
          "socialLinks": { "instagram": "https.www.instagram.com/chaudharydisplay", "facebook": "https.www.facebook.com", "linkedin": "#" }
        };

        // ==========================================
        // 2. LOGIC & FUNCTIONS
        // ==========================================

        // --- Auth ---
        function login() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(e, p).catch(err => {
                if(err.code === 'auth/user-not-found') auth.createUserWithEmailAndPassword(e,p).then(login);
                else document.getElementById('login-msg').innerText = "Incorrect email or password.";
            });
        }
        function logout() { auth.signOut(); window.location.reload(); }
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('login-overlay').classList.add('hidden');
                loadData();
            }
        });

        // --- Data Loading ---
        function loadData() {
            db.ref('websiteData').once('value', snapshot => {
                currentData = snapshot.val() || JSON.parse(JSON.stringify(defaultData));
                renderAll();
            });
        }

        // --- Render Functions ---
        function renderAll() {
            // About
            document.getElementById('about-text').value = currentData.aboutText || '';
            document.getElementById('about-img').value = currentData.aboutImageUrl || '';
            updatePreview('about-preview', currentData.aboutImageUrl);

            // Contact
            if(currentData.contactInfo) {
                document.getElementById('contact-phone').value = currentData.contactInfo.phone || '';
                document.getElementById('contact-email').value = currentData.contactInfo.email || '';
                document.getElementById('contact-address').value = currentData.contactInfo.address || '';
            }

            // Lists
            renderList('serviceCategories', 'list-serviceCategories', (item, i) => `
                <div class="flex items-center bg-white p-3 rounded shadow-sm border">
                    <input type="text" class="flex-1 bg-transparent outline-none font-medium text-gray-700" value="${item}" onchange="updateListItem('serviceCategories', ${i}, this.value)">
                    <button onclick="deleteListItem('serviceCategories', ${i})" class="text-red-400 hover:text-red-600 ml-2"><i class="fas fa-trash"></i></button>
                </div>
            `);

            renderList('facilities', 'list-facilities', (item, i) => `
                <div class="flex items-center bg-white p-4 rounded shadow-sm border border-l-4 border-green-500">
                    <i class="fas fa-check-circle text-green-500 mr-3"></i>
                    <input type="text" class="flex-1 bg-transparent outline-none text-gray-700" value="${item}" onchange="updateListItem('facilities', ${i}, this.value)">
                    <button onclick="deleteListItem('facilities', ${i})" class="text-red-400 hover:text-red-600 ml-2"><i class="fas fa-trash"></i></button>
                </div>
            `);

            renderList('testimonials', 'list-testimonials', (t, i) => `
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 relative group">
                    <button onclick="deleteListItem('testimonials', ${i})" class="absolute top-3 right-3 text-red-300 hover:text-red-600 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-trash-alt"></i></button>
                    <div class="mb-3">
                        <label class="text-xs font-bold text-gray-400 uppercase">Client Name</label>
                        <input type="text" class="w-full font-bold text-gray-800 border-b border-dashed focus:border-blue-500 outline-none pb-1" value="${t.name}" onchange="updateDeepItem('testimonials', ${i}, 'name', this.value)">
                    </div>
                    <div class="mb-3">
                        <label class="text-xs font-bold text-gray-400 uppercase">Event Type</label>
                        <input type="text" class="w-full text-sm text-blue-600 border-b border-dashed focus:border-blue-500 outline-none pb-1" value="${t.event}" onchange="updateDeepItem('testimonials', ${i}, 'event', this.value)">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase">Review</label>
                        <textarea rows="3" class="w-full text-gray-600 text-sm mt-1 p-2 bg-gray-50 rounded border-none resize-none" onchange="updateDeepItem('testimonials', ${i}, 'quote', this.value)">${t.quote}</textarea>
                    </div>
                </div>
            `);

            // Gallery (Simple URL list)
            renderList('galleryImages', 'list-galleryImages', (url, i) => `
                <div class="flex gap-2">
                    <input class="flex-1 border p-2 rounded" value="${url}" onchange="updateListItem('galleryImages', ${i}, this.value)">
                    <button onclick="deleteListItem('galleryImages', ${i})" class="text-red-500 px-2"><i class="fas fa-times"></i></button>
                </div>
            `);
        }

        // --- Helper Helpers ---
        function renderList(key, containerId, templateFn) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            (currentData[key] || []).forEach((item, index) => {
                container.innerHTML += templateFn(item, index);
            });
        }

        function updatePreview(id, src) {
            const el = document.getElementById(id);
            if(src) { el.src = src; el.classList.remove('hidden'); }
            else { el.classList.add('hidden'); }
        }

        // --- CRUD Operations ---
        function updateListItem(key, index, val) { currentData[key][index] = val; }
        function updateDeepItem(key, index, field, val) { currentData[key][index][field] = val; }
        
        function deleteListItem(key, index) {
            if(confirm('Delete this item?')) {
                currentData[key].splice(index, 1);
                renderAll();
            }
        }

        function addSimpleItem(key) {
            if(!currentData[key]) currentData[key] = [];
            currentData[key].push(key === 'galleryImages' ? 'https://' : 'New Item');
            renderAll();
        }

        function addTestimonial() {
            if(!currentData.testimonials) currentData.testimonials = [];
            currentData.testimonials.push({ name: 'Client Name', event: 'Event Name', quote: 'Amazing service!' });
            renderAll();
        }

        // --- Saving & Restore ---
        function saveChanges() {
            // Harvest singular fields
            currentData.aboutText = document.getElementById('about-text').value;
            currentData.aboutImageUrl = document.getElementById('about-img').value;
            
            if(!currentData.contactInfo) currentData.contactInfo = {};
            currentData.contactInfo.phone = document.getElementById('contact-phone').value;
            currentData.contactInfo.email = document.getElementById('contact-email').value;
            currentData.contactInfo.address = document.getElementById('contact-address').value;

            // Push
            const btn = document.getElementById('save-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            db.ref('websiteData').set(currentData).then(() => {
                btn.innerHTML = '<i class="fas fa-save"></i> Publish Changes';
                const toast = document.getElementById('toast');
                toast.classList.remove('translate-y-24');
                setTimeout(() => toast.classList.add('translate-y-24'), 3000);
            });
        }

        function restoreDefaultData() {
            if(confirm("WARNING: This will erase all your custom text, photos, and lists and reset them to the original template. Are you sure?")) {
                currentData = JSON.parse(JSON.stringify(defaultData));
                renderAll();
                saveChanges();
                alert("Data restored to defaults.");
            }
        }

        // --- Navigation ---
        function switchTab(tabId) {
            document.querySelectorAll('.section-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('panel-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
            
            // Mobile: close sidebar logic could go here if needed
        }
    </script>
</body>
</html>
